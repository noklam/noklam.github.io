<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-07-11">
<meta name="description" content="Notes for EuroPython2022 (Update daily)">

<title>noklam - EuroPython 2022 - Conference Notes &amp; Summary</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-83544344-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="noklam - EuroPython 2022 - Conference Notes &amp; Summary">
<meta property="og:description" content="Notes for EuroPython2022 (Update daily)">
<meta property="og:image" content="https://github.com/noklam.github.io/archive/posts/images/europython.jpg">
<meta property="og:site-name" content="noklam">
<meta name="twitter:title" content="noklam - EuroPython 2022 - Conference Notes &amp; Summary">
<meta name="twitter:description" content="Notes for EuroPython2022 (Update daily)">
<meta name="twitter:image" content="https://github.com/noklam.github.io/archive/posts/images/europython.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">noklam</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive/index.html">
 <span class="menu-text">Archive</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/noklam"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">EuroPython 2022 - Conference Notes &amp; Summary</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/" class="sidebar-item-text sidebar-link">Blog</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#bulletproof-python-property-based-testing-with-hypothesis" id="toc-bulletproof-python-property-based-testing-with-hypothesis" class="nav-link active" data-scroll-target="#bulletproof-python-property-based-testing-with-hypothesis">Bulletproof Python – Property-Based Testing with Hypothesis</a></li>
  <li><a href="#tdd-development-with-pytest" id="toc-tdd-development-with-pytest" class="nav-link" data-scroll-target="#tdd-development-with-pytest">TDD Development with pytest</a></li>
  <li><a href="#python-objects-under-the-hood" id="toc-python-objects-under-the-hood" class="nav-link" data-scroll-target="#python-objects-under-the-hood">Python objects Under the hood</a></li>
  <li><a href="#norvigs-lispy-beautiful-and-illuminating-python-code" id="toc-norvigs-lispy-beautiful-and-illuminating-python-code" class="nav-link" data-scroll-target="#norvigs-lispy-beautiful-and-illuminating-python-code">Norvig’s lispy: beautiful and illuminating Python code</a>
  <ul>
  <li><a href="#introduction-to-apache-tvm" id="toc-introduction-to-apache-tvm" class="nav-link" data-scroll-target="#introduction-to-apache-tvm">Introduction to Apache TVM</a></li>
  </ul></li>
  <li><a href="#typing.protocol-in-python-available-in-python-3.8" id="toc-typing.protocol-in-python-available-in-python-3.8" class="nav-link" data-scroll-target="#typing.protocol-in-python-available-in-python-3.8"><code>typing.Protocol</code> in Python (Available in Python 3.8+)</a></li>
  <li><a href="#what-happened-when-you-import-a-python-library" id="toc-what-happened-when-you-import-a-python-library" class="nav-link" data-scroll-target="#what-happened-when-you-import-a-python-library">What Happened when you import a Python Library?</a>
  <ul>
  <li><a href="#how-many-modules-imported-in-python-by-default" id="toc-how-many-modules-imported-in-python-by-default" class="nav-link" data-scroll-target="#how-many-modules-imported-in-python-by-default">How many modules imported in Python by default?</a></li>
  </ul></li>
  <li><a href="#make-cpython-faster" id="toc-make-cpython-faster" class="nav-link" data-scroll-target="#make-cpython-faster">Make CPython Faster</a></li>
  <li><a href="#jupyter-under-the-hood" id="toc-jupyter-under-the-hood" class="nav-link" data-scroll-target="#jupyter-under-the-hood">Jupyter Under the hood</a></li>
  <li><a href="#hydra-configuration-for-experiments" id="toc-hydra-configuration-for-experiments" class="nav-link" data-scroll-target="#hydra-configuration-for-experiments">Hydra configuration for experiments</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/noklam/noklam.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">EuroPython 2022 - Conference Notes &amp; Summary</h1>
  <div class="quarto-categories">
    <div class="quarto-category">europython</div>
  </div>
  </div>

<div>
  <div class="description">
    Notes for EuroPython2022 (Update daily)
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 11, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/europython_welcome.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">EuroPython2022</figcaption><p></p>
</figure>
</div>
<p>Schedule: https://ep2022.europython.eu/schedule/</p>
<p>Session that I attended: #europython</p>
<ul>
<li>Properties testing with Hypothesis</li>
<li>TDD Development with Pytest</li>
<li>Python Object under the hood</li>
<li>Norvig’s lispy - beautiful and illuminating Python code</li>
<li>Introduction to Apache TVM</li>
<li>From pip to poetry - Python ways of packagin and publishing</li>
<li>Czech Drourght monitoring system - from manual work to global drought monitoring and mahcine learning with Python Protocol in Python</li>
<li>Dance with shadows - stub mock and patch</li>
<li>What Happen when you import a library in Python</li>
<li>Music and code - good presentation</li>
<li>Dodging AI Dystopia</li>
<li>Make CPython Faster - Mark Shannon</li>
<li>Use animated charts to present &amp; share your findings with ipyvizzu</li>
<li>DOCUMENTATION AS SECRET WEAPON</li>
<li>JWST - James Webb Telescope</li>
<li>Jupyter Under the hood architecture</li>
<li>Python thread safety parallelism without GIL</li>
<li>CPython Internals - implementation with a pipe operator</li>
<li>Hydra configuration with experiment</li>
</ul>
<section id="bulletproof-python-property-based-testing-with-hypothesis" class="level2">
<h2 class="anchored" data-anchor-id="bulletproof-python-property-based-testing-with-hypothesis">Bulletproof Python – Property-Based Testing with Hypothesis</h2>
<p>The term <strong>property based testing</strong> isn’t too important. In a nutshell <code>hypothesis</code> is a python library that help you to write (better) tests by modifying your workflow.</p>
<ol type="1">
<li><del>Prepare mock data</del> Provide a specification of data, let <code>hypothesis</code> do the work</li>
<li>Perform some operation</li>
<li>Assert the result with expected value</li>
</ol>
<p>The rationale behind this is</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>** People write code don’t come up with good test. **</p>
</div>
</div>
<p>For example, you can generate integers with <code>hypotesis.strategies.integers</code>, it does something smart under the hood so it’s not just random number but more meaningful test. For example, you usually want to test for zero, negative number, positive number, large number. <code>hypoethsis</code> try to maximize the variety of tests and you just need to give it a specification.</p>
<p>You can also generate more sophisticated data, for example, a tuple of two integers, where the second integer has to be larger than the first one.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">@st.composite</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_and_index(draw, elements<span class="op">=</span>st.integers()):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; first <span class="op">=</span> draw(elements)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; second <span class="op">=</span> draw(st.integers(min_value<span class="op">=</span>first <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="cf">return</span> (first, second)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Think of it as your virtual QA buddy.</p>
</section>
<section id="tdd-development-with-pytest" class="level2">
<h2 class="anchored" data-anchor-id="tdd-development-with-pytest">TDD Development with pytest</h2>
<p>Workflow for TDD 1. Pick one bug/missing feature 2. Write a test that fails 3. Minimal amount of code that pass - (even hard coded!) 4. Refactor</p>
<p>There are good questions asked * In case of you don’t know what’s the expected answer, how do you write test that fails meaningfully?</p>
<p>I jump out of the session because of a call, so not too many comments about this session. In general I like the idea of TDD but struggle to apply the textbook version of TDD as examples are often much simpler than the real application.</p>
<p>Few key points * Tests as specification about your program (What it does and what not) * Understand why you test fail and pass. * Tests are also good source of documentation.</p>
<p>Thinking about test first also force you to think more about the design, you almost start from pseudocode (you function doesn’t even exist!).</p>
</section>
<section id="python-objects-under-the-hood" class="level1">
<h1>Python objects Under the hood</h1>
<p>Covers a lot about Python’s magic method * <code>__init__</code> add <code>__new__</code> * <code>__add__</code> and <code>__radd__</code> * <code>super()</code> * <code>__str__</code> and <code>__repr__</code> * <code>__next__</code> and <code>__iter__</code> * Why <code>__new__</code> is needed? * We need to create immutable object * Object creation start with <code>__new__</code> which create an instance -&gt; <code>__init__</code> to customize the attributes * We need <code>__new__</code> to create a new immutable object * But how’s python actually achieve immutable tuple? Unanswered</p>
<p><a href="https://mail.python.org/pipermail/tutor/2008-April/061426.html">[Tutor] When to use <strong>new</strong> vs.&nbsp;<strong>init</strong> ?</a> &gt; <strong>new</strong> is the first step of instance creation. It’s called first, and is responsible for returning a new instance of your class. In contrast, <strong>init</strong> doesn’t return anything; it’s only responsible for initializing the instance after it’s been created.</p>
</section>
<section id="norvigs-lispy-beautiful-and-illuminating-python-code" class="level1">
<h1>Norvig’s lispy: beautiful and illuminating Python code</h1>
<p>This is an interesting exercise to implement an <code>Lisp</code> interpreter in <code>Python</code>. I am not from CS background so this is brand new to me, and uncover some of the details that how programming language actually works. It involves parsing text into <code>tokens</code> and evaluate them with some grammar which can be represented as AST.</p>
<p>This is the AST for the example <code>(define double (lambda (n) (* n 2)))</code> drawn as a tree <a href="https://github.com/fluentpython/lispy/tree/main/workshops/europython2022">reference</a>:</p>
<pre><code>                              '*'  'n'   2  
                        'n'    └────┼────┘  
                         │          │  
           'lambda'     [ ]        [ ]  
               └─────────┼──────────┘  
                         │  
'define'   'double'     [ ]  
    └─────────┼──────────┘  
              │  
             [ ]  </code></pre>
<p>The speaker also introduce <code>ChainMap</code>, which I am not aware of before.</p>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> ChainMap</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> {<span class="st">'a'</span>:<span class="dv">1</span>}</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> {<span class="st">'b'</span>: <span class="dv">2</span>}</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> {<span class="st">'b'</span>: <span class="dv">3</span>, <span class="st">'c'</span>:<span class="dv">4</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>chainmap <span class="op">=</span> ChainMap(a,b,c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <code>ChainMap</code> stores multiple dictionaries, instead of merging them they are all stored in the object. Take a guess which `chainmap[‘a’], chainmap[‘b’] are?</p>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>chainmap[<span class="st">'a'</span>], chainmap[<span class="st">'b'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>(1, 2)</code></pre>
</div>
</div>
<p>It pretty much behaves like a normal Python dictionary, except that when the same key exists in more than one of the dictionary, the one that is in the front of the argument list has higher priority.</p>
<section id="introduction-to-apache-tvm" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-apache-tvm">Introduction to Apache TVM</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="europython/tvm.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Apache TVM</figcaption><p></p>
</figure>
</div>
<ul>
<li>Apache TVM is a framework that try to squeeze extra performance from specialized hardware.</li>
</ul>
<p>In practice, the workflow roughly go like this 1. Trained a model with your favored libraries (PyTorch/Tensorflow etc) 2. Use TVM to compile and tune -&gt; After this you get a compiled module as output 3. Use TVM python API for inference</p>
<p>The performance gains are mainly from hardware architecture that can give better performance, TVM did some architecture search and try to find the optimal one.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Maybe one side benefit of this is it does not need the deep learning pipeline dependecenies since you just need the TVM Python API and the model file for inference.</p>
</div>
</div>
</section>
</section>
<section id="typing.protocol-in-python-available-in-python-3.8" class="level1">
<h1><code>typing.Protocol</code> in Python (Available in Python 3.8+)</h1>
<p>Since the introduction of type hints, it has been a popular python feature and a lot more static analysis tools is added into the Python ecosystem. The most popular static analysis tool in Python is <code>mypy</code>.</p>
<p><code>Protocol</code> is a way of strcutural subtyping, it’s best to understand it with an Example.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Dog:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Cat:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> eat_bread(Union[Dog, Cat]):</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    do_somthing()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Imagine if you are importing the <code>eat_bread</code> function and you want to extend it with a new animal type. There are no way you can do it unless you go into the source code of the library and change the argument.</p>
<p><code>Protocol</code> solve this problem in a way that I think it’s quite similar to <code>traits</code>, which is quite common in languages like <code>Scala</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EatsBread(Protocol):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> eat_bread(<span class="va">self</span>):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> feed_bread(animal: EatsBread):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    animal.eat_bread()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Duck:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> eat_bread(<span class="va">self</span>):</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>feed_bread(Duck())  <span class="co"># &lt;-- OK</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Python is a dynamic typing language, which is flexible with duck typing. In essence, if something can <code>swim</code> and <code>quack</code>, it’s close enough to be consider as a duck. We only care about what the <code>class</code> can do, not the type of the class. So in this case, <code>Duck</code> has a method of <code>eat_bread</code>, and it maches the <code>Protocol</code> method and the static analysis tool will not have problem with it. As a result, we don’t need to extend the <code>class</code> or add a new class to <code>Union</code> everytime we extend a new class.</p>
</section>
<section id="what-happened-when-you-import-a-python-library" class="level1">
<h1>What Happened when you import a Python Library?</h1>
<p>This is an interesting talk as I recently had a bug that related to this exactly. It was a bug that due to different mechanism of <code>multiprocess</code>, In Windows and some versions of Mac, it used a <code>spawn process</code>, in Linux it is <code>fork process</code>. The main difference is that <code>spawn process</code> will re-import all the Python modules in the new process and cause some issues. In short, it’s not a good idea to have side-effect when importing a library, always put that into a <code>__name__ == __main__</code> block.</p>
<ul>
<li><code>modules</code> are python object -&gt; you can do something like <code>import random; type(random)</code></li>
<li>Whenever you import a module, a module object is created with a name, optionally you can alias it with <code>import module as xyz</code></li>
<li>sys.modules is the Python VM that keep track of the imported library as a <code>dict</code>
<ul>
<li>Since it is a dict, where the key is the name of the module and value as the module object</li>
<li>If the module is imported more than 1 time, the <code>sys.modules</code> is smart enough to skip the import since the key already exist. It will just use the <code>module</code> object instead.</li>
</ul></li>
</ul>
<section id="how-many-modules-imported-in-python-by-default" class="level2">
<h2 class="anchored" data-anchor-id="how-many-modules-imported-in-python-by-default">How many modules imported in Python by default?</h2>
<ul>
<li>Python Shell - 79</li>
<li>IPython - 646!</li>
<li>Jupyter - 1020!!!</li>
</ul>
<p>It’s quite surprising how many libraries are imported by default, and this explains why it takes some time whenever you do <code>ipython</code> on a shell, as the Python Interpreter is busy reading all the files and evalute it.</p>
<p>Some other interesting notes: * Python use a <code>Finder</code> and <code>Loader</code> to import modules * <code>sys.path</code> is the order that Python Interpreter search for modules, and the first match wins (This is important if you have duplicate namespace or if you do namespace package) * Don’t do <code>sys.path.append</code> although you will find this very common if you do a Stackoverflow search, use environment variable <code>PYTHONPATH=some_path</code> instead</p>
</section>
</section>
<section id="make-cpython-faster" class="level1">
<h1>Make CPython Faster</h1>
<p>The talk was delivered by Mark Shannon. The pace of the talk is quite fast and I couldn’t understand the details, but I think it is a good source of food for thought. Some keypoints * Memory access is slow * Dependent memory read is slower - 2 read is 2x slower because it has to be executed in sequence How to make Python 3.11 faster? * Lazy debugging info creation * (Almost) Zero Cost exceptions * In the try-block - push address to stack of the exception handler * with the expense of more memory - performance is improved in general case, but more expensive when exeception is raised</p>
</section>
<section id="jupyter-under-the-hood" class="level1">
<h1>Jupyter Under the hood</h1>
<ul>
<li>ZMQ as the network Protocol</li>
<li>Dealer socker &amp; router Socket</li>
<li>3 types of channels
<ul>
<li>shell</li>
<li>IO pub</li>
<li>STDIN</li>
</ul></li>
</ul>
</section>
<section id="hydra-configuration-for-experiments" class="level1">
<h1>Hydra configuration for experiments</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>`hydra` <span class="kw">is</span> a Python Library that support configuration <span class="cf">with</span> many advance features, which built on top of `OmegaConf`.</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Features include:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> `instantiate` <span class="op">-</span> dependency injection <span class="cf">with</span> configuration <span class="op">-</span> <span class="cf">for</span> example you can do a partial instantiate</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Type checking</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Tab completion <span class="cf">for</span> configuration</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Multi<span class="op">-</span>run </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Supports plugins</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Split configurations <span class="kw">in</span> multiple YAML files</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> The structure of files largely resemble how a Python modules works. i.e. module.sub_module.xxx</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>Some downsides:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> It use Singleton <span class="kw">and</span> cause some problem</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>